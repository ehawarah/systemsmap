<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Integration Map</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap');
  
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    background: #0d0d1a;
    font-family: 'DM Sans', sans-serif;
    color: #e0e0e0;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
  }
  
  #canvas-container {
    position: relative;
    width: 100%;
    height: 100%;
  }
  
  svg { width: 100%; height: 100%; }
  
  .tooltip {
    position: fixed;
    pointer-events: none;
    background: #1a1a2eee;
    border: 1px solid #333;
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 12px;
    line-height: 1.6;
    max-width: 300px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 100;
  }
  .tooltip.visible { opacity: 1; }
  .tooltip .tt-name { font-weight: 700; font-size: 13px; margin-bottom: 4px; }
  .tooltip .tt-cat { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; margin-bottom: 6px; }
  .tooltip .tt-row { display: flex; justify-content: space-between; gap: 12px; }
  .tooltip .tt-label { color: #888; }
  .tooltip .tt-val { font-weight: 600; }
  .tooltip .tt-mc { color: #e8735a; font-weight: 700; font-size: 11px; margin-top: 4px; }
  
  .legend {
    position: fixed;
    bottom: 16px;
    left: 16px;
    background: #12121ecc;
    backdrop-filter: blur(12px);
    border: 1px solid #2a2a44;
    border-radius: 12px;
    padding: 14px 18px;
    font-size: 11px;
    z-index: 50;
  }
  .legend-title {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #666;
    margin-bottom: 8px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 2px 0;
    color: #aaa;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .legend-item:hover { opacity: 1; }
  .legend-item .swatch {
    width: 10px;
    height: 10px;
    border-radius: 3px;
    flex-shrink: 0;
  }
  .legend-item .count {
    margin-left: auto;
    color: #555;
    font-size: 10px;
  }
  
  .controls {
    position: fixed;
    top: 16px;
    left: 16px;
    display: flex;
    gap: 8px;
    z-index: 50;
  }
  .controls select {
    background: #1a1a2e;
    color: #ccc;
    border: 1px solid #2a2a44;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    cursor: pointer;
  }
  .controls button {
    background: #1a1a2e;
    color: #ccc;
    border: 1px solid #2a2a44;
    border-radius: 8px;
    padding: 8px 14px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    cursor: pointer;
    transition: background 0.2s;
  }
  .controls button:hover { background: #2a2a44; }
  .controls button.active { background: #e8735a33; border-color: #e8735a55; color: #e8735a; }
  
  .title-bar {
    position: fixed;
    top: 16px;
    right: 16px;
    text-align: right;
    z-index: 50;
  }
  .title-bar h1 {
    font-size: 16px;
    font-weight: 700;
    color: #e0e0e0;
  }
  .title-bar h1 span { color: #e8735a; }
  .title-bar p { font-size: 10px; color: #555; margin-top: 2px; }
  
  /* Hex clip path for nodes */
  .hex-node { transition: opacity 0.3s, transform 0.3s; }
  .hex-node:hover { filter: brightness(1.3); }
  .connection-line { transition: opacity 0.3s; }
  
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes pulseGlow { 0%, 100% { filter: drop-shadow(0 0 4px rgba(232,115,90,0.3)); } 50% { filter: drop-shadow(0 0 12px rgba(232,115,90,0.6)); } }
  .hub-glow { animation: pulseGlow 3s ease-in-out infinite; }
</style>
</head>
<body>

<div class="title-bar">
  <h1><span>●</span> System Integration Map</h1>
  <p id="stats-line"></p>
</div>

<div class="controls">
  <select id="filter-cat">
    <option value="All">All Categories</option>
  </select>
  <select id="filter-owner">
    <option value="All">All Owners</option>
  </select>
  <button id="btn-mc">★ Mission Critical Only</button>
  <button id="btn-reset">Reset View</button>
</div>

<div id="canvas-container">
  <svg id="main-svg"></svg>
</div>

<div class="legend" id="legend"></div>
<div class="tooltip" id="tooltip"></div>

<script>
// ─── DATA ────────────────────────────────────────────────────────
const SYSTEMS = [
["Building Automation System (BAS)","Gautham Sunkara","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["UPS Monitoring","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,""],
["Heat Recovery Chiller","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Variable Frequency Drives","Gautham Sunkara","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Digital Integration Platform","","Digital Integration & Platform",false,"Included in the Design"],
["Independent Data Layer (IDL)","","Digital Integration & Platform",false,"Included in the Design"],
["Analytics & Insights","","Digital Integration & Platform",false,"Included in the Design"],
["Event Management and Rule Execution","","Digital Integration & Platform",false,"Included in the Design"],
["Cognitive Automation and Agentic AI","","Digital Integration & Platform",false,"Future"],
["Cyber Security & Resilience","","Digital Integration & Platform",false,""],
["AV Systems","","Workplace Experience & Logistics",false,"Included in the Design"],
["Digital Signage Systems","","Workplace Experience & Logistics",false,"Included in the Design"],
["IPTV and Digital Distribution Systems","","Workplace Experience & Logistics",false,"Included in the Design"],
["Video Conference System","","Workplace Experience & Logistics",false,"Anticipated for Day 1"],
["Room Scheduling Systems","","Workplace Experience & Logistics",false,"Included in the Design"],
["Custom Video Wall Systems","","Workplace Experience & Logistics",false,"Included in the Design"],
["Flexible Interconnect AV Distribution System","","Workplace Experience & Logistics",false,"Included in the Design"],
["Water-Based Fire-Suppression Water Supply","","",false,""],
["Wet Pipe Sprinkler System","Michael Harris","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Preaction Sprinkler System","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Future"],
["Clean Agent Fire Extinguishing System","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Lab Equipment","Heather Jutila","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Freezer / Ice machine / Incubators","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Biological Safety Cabinets","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Laboratory Fume Hoods","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Airflow Monitoring and Alarm System","Heather Jutila","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Auto Sash Operator and Controller","Heather Jutila","Vivarium & Biocontainment Systems",false,""],
["RODENT HOUSING EQUIPMENT","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Individually Ventilated Cage (IVC)","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Animal Transfer Station (ATS)","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["CAGE PROCESSING EQUIPMENT","Heather Jutila","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Cage & Rack Washer","Heather Jutila","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Tunnel Washer","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Automated Soiled (Dirty Side) Bedding Disposal System","Heather Jutila","Vivarium & Biocontainment Systems",true,"Anticipated for Day 1"],
["Automated Fresh (Clean Side) Bedding Dispensing System","Heather Jutila","Vivarium & Biocontainment Systems",true,"Anticipated for Day 1"],
["Automated Cage Process System","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Robotic Automation System","","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Automated Bottle Washing and Filling System","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Animal Drinking Water Pouch System","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Steam Sterilizer/Dry Heat Sterilizer","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Animal Monitoring/Tracking Systems","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Animal Feeding System","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Lab Elevator Systems","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Passenger Elevators","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Service Elevators","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Vivarium Elevator Systems","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Passenger Elevators (Viv)","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Service Elevators (Viv)","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Power Distribution System","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Future"],
["Lighting Controls","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Window Treatments","Melissa Chong","Workplace Experience & Logistics",false,"Included in the Design"],
["Electrified Door Hardware","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Electronic access control system","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Controlled Environmental Rooms","Melissa Chong","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Security Center","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Access Control and Alarm Monitoring (ACAMS)","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Video Surveillance Systems (VSS)","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Video Management System (VMS)","Philip Moul","Security, Safety & Health (SSHE)",false,"Anticipated for Day 1"],
["Genetec Omnicast and AutoVu","Philip Moul","Security, Safety & Health (SSHE)",true,""],
["Network Video Recorders (NVR)","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Genetec Stream Vault","Philip Moul","Security, Safety & Health (SSHE)",true,""],
["Cameras","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Security Communications Systems (SCS)","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Electronic Security Systems (ESS)","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["SIP-based IP intercom","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["blue light emergency communication devices","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["ClearID","","Enterprise IT",true,"Included in the Design"],
["Synergis / Alarm Management Platforms","Gautham Sunkara","Security, Safety & Health (SSHE)",true,"Anticipated for Day 1"],
["Fire Detection and Alarm","Michael Harris","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["smoke detectors","Michael Harris","Security, Safety & Health (SSHE)",false,""],
["heat detectors","Michael Harris","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["duct detectors","Michael Harris","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["audio/visual signaling devices","Michael Harris","Security, Safety & Health (SSHE)",false,""],
["manual pull stations","Michael Harris","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Gas Detection and Alarm","Michael Harris","Security, Safety & Health (SSHE)",true,"Included in the Design"],
["Refrigeration Detection and Alarm","","Security, Safety & Health (SSHE)",false,""],
["Emergency voice alarm communication system","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Facility Power Generation","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["emergency Power supply System (EPSS)","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Battery Energy Storage Systems (BESS)","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Future"],
["Electrical Service and Distribution","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Automation Controls and SCADA","Gautham Sunkara","Core Building Autonomy (MEP & Energy)",false,""],
["Electrical Metering/Sub-Metering","Behzad T.","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Power Monitoring Meters","","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Facility Fuel Systems","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Heat Generation","","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Thermal Heat Storage","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Facility Hydronic Distribution","","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Refrigerated & Heating Hot Water System","","Core Building Autonomy (MEP & Energy)",false,""],
["Cyclotron Refrigerated Water System","","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Facility Steam Distribution","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["HVAC Air Distribution","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Exhaust Abatement","Michael Harris","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Cyclotron Exhaust System","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,""],
["H-Occupancy Exhaust Air System","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Air Quality Monitoring System","Melissa Chong","Security, Safety & Health (SSHE)",true,"Included in the Design"],
["Temperature sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Relative humidity sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["TVOC sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,""],
["Particulate Matter Sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,""],
["Carbon dioxide sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Nitrogen Dioxide Sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Atmospheric Pressure","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Light sensor","Melissa Chong","Security, Safety & Health (SSHE)",true,"Included in the Design"],
["Occupancy sensor","Melissa Chong","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["IAQ sensor","Melissa Chong","Security, Safety & Health (SSHE)",true,"Included in the Design"],
["Animal Drinking Water","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Autonomous guided vehicle systems","","Scientific Automation & Robotics (Lab)",false,"Included in the Design"],
["ABSL-3 Specialized Air Handling","Melissa Chong (Site Ops)/Heather Jutila (gRED)","",false,"Included in the Design"],
["Airflow & Pressure Sensors","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["ASRS / Shuttle Systems","","Workplace Experience & Logistics",false,"Anticipated for Day 1"],
["Computer Room Air Conditioners (CRAC/CRAH)","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Controlled Environmental Rooms (HVAC)","Melissa Chong","Vivarium & Biocontainment Systems",true,"Included in the Design"],
["Critical Environment Controls","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Leak Detection","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Backbone Distribution","","Enterprise IT",false,"Included in the Design"],
["Data Integration Layer / APIs","","Enterprise IT",false,"Included in the Design"],
["Mobile Applications","","Enterprise IT",false,"Included in the Design"],
["Analytics & Dashboards","","Enterprise IT",false,"Included in the Design"],
["Smart Building / BMS Platforms","","Enterprise IT",false,"Included in the Design"],
["IoT Device Management Platform","","Enterprise IT",false,"Included in the Design"],
["Collaboration & Meeting Platforms","","Enterprise IT",false,"Included in the Design"],
["Main Distribution Frame (MDF)","","Enterprise IT",false,"Included in the Design"],
["Core Network Backbone","","Enterprise IT",false,"Included in the Design"],
["Network & Security Platforms","","Enterprise IT",false,"Included in the Design"],
["Wireless Networks","","Enterprise IT",false,"Included in the Design"],
["Secure Vendor / Remote Access","","Enterprise IT",false,"Included in the Design"],
["Network Monitoring & Redundancy","","Enterprise IT",false,"Included in the Design"],
["Non-Potable Reclaim Water","Behzad T.","Core Building Autonomy (MEP & Energy)",false,""],
["Facility Data Historian (FDH)","Gautham Sunkara","Digital Integration & Platform",false,"Included in the Design"],
["Processed Water/Water Treatment","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Domestic/Industrial Water Distribution","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Janitorial & Office Supply Flow","Melissa Chong","Workplace Experience & Logistics",false,"Included in the Design"],
["Gas Systems","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Carbon Dioxide","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Helium Recovery System","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Gaseous Nitrogen","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Liquid Nitrogen","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Oxygen","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Specialty Gases","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Hydrogen","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Chemical Waste Systems","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Laboratory and Vivarium Vacuum","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Lab and Vivarium Compressed Air","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Processed Water Systems","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Reagent Stores & Solvent Dispensing","Melissa Chong","Scientific Automation & Robotics (Lab)",true,"Included in the Design"],
["Water Metering/Sub-Metering","Behzad T.","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Campus Lockdown System","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Pre-order kiosks","","Workplace Experience & Logistics",false,"Included in the Design"],
["Gaseous Decontamination Chambers","Melissa Chong","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Fault Detection / Preventative Maintenance","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,"Included in the Design"],
["Laboratory Sterilizers","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Scientific Automation & Robotics (Lab)",false,"Included in the Design"],
["Employee Health Pods","","Workplace Experience & Logistics",false,"Included in the Design"],
["Personal Lockers","","Workplace Experience & Logistics",false,"Included in the Design"],
["Wayfinding","","Workplace Experience & Logistics",false,""],
["Weapons Detection","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Access Code Governance","Philip Moul","Security, Safety & Health (SSHE)",false,"Included in the Design"],
["Vehicle Charging Equipment (EV)","","Workplace Experience & Logistics",false,"Included in the Design"],
["Valet System","","Workplace Experience & Logistics",false,""],
["Sound Masking","","Workplace Experience & Logistics",false,"Included in the Design"],
["Location Tracking Systems (RTLS)","Philip Moul","Workplace Experience & Logistics",false,"Included in the Design"],
["Vivarium Hygiene Barrier Access","Heather Jutila","Vivarium & Biocontainment Systems",false,"TBD/Unknown"],
["Vivarium Logistics & Management","Melissa Chong (Site Ops)/Heather Jutila (gRED)","Vivarium & Biocontainment Systems",true,""],
["Vivarium Waste Management","","Vivarium & Biocontainment Systems",false,"TBD/Unknown"],
["ESG Platform","Michael Harris","Core Building Autonomy (MEP & Energy)",false,""],
["Mail Room Management","Jozef Bolech","Workplace Experience & Logistics",false,"Included in the Design"],
["Asset Management","Melissa Chong","Workplace Experience & Logistics",false,"Anticipated for Day 1"],
["IWMS / CMMS","Melissa Chong","Core Building Autonomy (MEP & Energy)",false,""],
["Drone & Robot Security Patrols","","Security, Safety & Health (SSHE)",false,""],
["Emergency Services Staging","Philip Moul","Security, Safety & Health (SSHE)",false,""],
["Stormwater Control System","Michael Harris","Core Building Autonomy (MEP & Energy)",false,""],
["Aquatics Environmental Support","Heather Jutila","Vivarium & Biocontainment Systems",false,"Included in the Design"],
["Master Clock Systems","Heather Jutila","Scientific Automation & Robotics (Lab)",false,"Included in the Design"],
["Air Handler Units (AHUs)","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"],
["Airflow & Pressure Sensors (HVAC)","Melissa Chong","Core Building Autonomy (MEP & Energy)",true,"Included in the Design"]
];

// Edges: [sourceIdx, targetIdx]
const EDGES = [[1,0],[2,0],[3,0],[4,21],[5,4],[6,4],[25,0],[27,40],[30,49],[30,129],[31,49],[31,129],[32,35],[35,34],[38,0],[39,0],[45,129],[48,49],[52,51],[53,91],[55,66],[57,62],[57,58],[57,55],[62,56],[62,55],[67,66],[67,54],[77,0],[79,0],[80,129],[81,0],[81,129],[82,0],[83,0],[84,0],[86,0],[95,0],[96,0],[97,0],[98,0],[100,0],[103,0],[103,129],[105,0],[106,0],[110,0],[110,4],[111,122],[113,0],[114,0],[114,129],[116,0],[116,40],[117,0],[117,40],[118,0],[118,40],[119,0],[119,40],[120,0],[120,40],[121,0],[121,40],[129,0],[130,0],[131,0],[135,0],[136,0],[137,0],[138,0],[139,0],[140,0],[141,0],[142,0],[143,0],[145,0],[146,0],[151,0],[174,0]];

const CAT_COLORS = {
  "Core Building Autonomy (MEP & Energy)": "#E8735A",
  "Digital Integration & Platform": "#6C8EBF",
  "Enterprise IT": "#8B6DAF",
  "Scientific Automation & Robotics (Lab)": "#D4A843",
  "Security": "#5BA08A",
  "Security, Safety & Health (SSHE)": "#5BA08A",
  "Vivarium & Biocontainment Systems": "#C47AB3",
  "Workplace Experience & Logistics": "#7EAED4",
  "": "#666"
};

// ─── SETUP ───────────────────────────────────────────────────────
const svg = document.getElementById('main-svg');
const tooltip = document.getElementById('tooltip');
const NS = 'http://www.w3.org/2000/svg';

// Parse systems
const systems = SYSTEMS.map((s, i) => ({
  idx: i, name: s[0], owner: s[1], category: s[2] || 'Uncategorized',
  mc: s[3], status: s[4]
}));

// Connection counts
const connCount = {};
EDGES.forEach(([s, t]) => {
  connCount[s] = (connCount[s] || 0) + 1;
  connCount[t] = (connCount[t] || 0) + 1;
});

// Categories
const catSet = new Set(systems.map(s => s.category));
const categories = [...catSet].filter(c => c && c !== 'Uncategorized').sort();

// BAS is index 0 — the hub
const HUB_IDX = 0;

// ─── STATE ───────────────────────────────────────────────────────
let filterCat = 'All';
let filterOwner = 'All';
let mcOnly = false;
let highlightSystem = null;

// ─── LAYOUT ──────────────────────────────────────────────────────
function hexPath(cx, cy, r) {
  const pts = [];
  for (let i = 0; i < 6; i++) {
    const a = (Math.PI / 3) * i - Math.PI / 6;
    pts.push(`${cx + r * Math.cos(a)},${cy + r * Math.sin(a)}`);
  }
  return `M ${pts.join(' L ')} Z`;
}

function render() {
  svg.innerHTML = '';
  
  const W = window.innerWidth;
  const H = window.innerHeight;
  const cx = W / 2;
  const cy = H / 2;
  
  // Filter systems
  let visible = systems.filter(s => {
    if (s.idx === HUB_IDX) return true;
    if (filterCat !== 'All' && s.category !== filterCat) return false;
    if (filterOwner !== 'All' && s.owner !== filterOwner) return false;
    if (mcOnly && !s.mc) return false;
    return true;
  });
  
  // Separate hub from rest
  const hub = visible.find(s => s.idx === HUB_IDX);
  const others = visible.filter(s => s.idx !== HUB_IDX);
  
  // Group others by category
  const byCat = {};
  others.forEach(s => {
    if (!byCat[s.category]) byCat[s.category] = [];
    byCat[s.category].push(s);
  });
  
  const catKeys = Object.keys(byCat).sort();
  const totalSystems = others.length;
  
  // Assign angular segments per category
  const gap = 0.06;
  const totalGap = gap * catKeys.length;
  const avail = 2 * Math.PI - totalGap;
  
  const segments = [];
  let angle = -Math.PI / 2;
  catKeys.forEach(cat => {
    const frac = byCat[cat].length / totalSystems;
    const span = frac * avail;
    segments.push({ cat, start: angle, end: angle + span, systems: byCat[cat] });
    angle += span + gap;
  });
  
  // Defs
  const defs = document.createElementNS(NS, 'defs');
  
  // Radial gradient for background
  const rg = document.createElementNS(NS, 'radialGradient');
  rg.id = 'bgGlow';
  rg.innerHTML = `<stop offset="0%" stop-color="#1a1a3a" /><stop offset="100%" stop-color="#0d0d1a" />`;
  defs.appendChild(rg);
  
  // Glow filter
  const flt = document.createElementNS(NS, 'filter');
  flt.id = 'glow';
  flt.innerHTML = `<feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>`;
  defs.appendChild(flt);
  
  svg.appendChild(defs);
  
  // Background
  const bg = document.createElementNS(NS, 'rect');
  bg.setAttribute('width', W);
  bg.setAttribute('height', H);
  bg.setAttribute('fill', 'url(#bgGlow)');
  svg.appendChild(bg);
  
  // Draw category arc segments (donut ring)
  const ringR = Math.min(W, H) * 0.22;
  const ringW = 14;
  
  const gArcs = document.createElementNS(NS, 'g');
  segments.forEach(seg => {
    const path = document.createElementNS(NS, 'path');
    const r = ringR;
    const x1 = cx + r * Math.cos(seg.start), y1 = cy + r * Math.sin(seg.start);
    const x2 = cx + r * Math.cos(seg.end), y2 = cy + r * Math.sin(seg.end);
    const large = (seg.end - seg.start) > Math.PI ? 1 : 0;
    path.setAttribute('d', `M ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2}`);
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke', CAT_COLORS[seg.cat] || '#666');
    path.setAttribute('stroke-width', ringW);
    path.setAttribute('stroke-linecap', 'round');
    path.setAttribute('opacity', '0.4');
    gArcs.appendChild(path);
    
    // Category label along arc
    const mid = (seg.start + seg.end) / 2;
    const lr = ringR + 20;
    const lx = cx + lr * Math.cos(mid), ly = cy + lr * Math.sin(mid);
    const txt = document.createElementNS(NS, 'text');
    txt.setAttribute('x', lx);
    txt.setAttribute('y', ly);
    txt.setAttribute('fill', CAT_COLORS[seg.cat] || '#888');
    txt.setAttribute('font-size', '9');
    txt.setAttribute('font-weight', '600');
    txt.setAttribute('text-anchor', 'middle');
    txt.setAttribute('dominant-baseline', 'middle');
    txt.setAttribute('opacity', '0.7');
    const shortName = seg.cat.length > 20 ? seg.cat.replace(/ & /g, '/').replace(/\(.*?\)/g, '').trim().slice(0, 22) : seg.cat;
    txt.textContent = shortName;
    
    // Rotate to follow arc
    const deg = mid * (180 / Math.PI);
    const flip = deg > 90 || deg < -90;
    txt.setAttribute('transform', `rotate(${flip ? deg + 180 : deg}, ${lx}, ${ly})`);
    if (flip) txt.setAttribute('text-anchor', 'middle');
    gArcs.appendChild(txt);
  });
  svg.appendChild(gArcs);
  
  // Position nodes in rings outside the donut
  const nodePositions = {};
  const innerR = ringR + 44;
  const outerR = Math.min(W, H) * 0.44;
  
  segments.forEach(seg => {
    const n = seg.systems.length;
    // Systems with connections to BAS go in inner ring, others outer
    const connected = seg.systems.filter(s => connCount[s.idx]);
    const unconnected = seg.systems.filter(s => !connCount[s.idx]);
    
    const allSorted = [...connected.sort((a, b) => (connCount[b.idx] || 0) - (connCount[a.idx] || 0)), ...unconnected];
    
    const angSpan = seg.end - seg.start;
    const rings = allSorted.length > 8 ? 3 : allSorted.length > 4 ? 2 : 1;
    
    allSorted.forEach((s, i) => {
      const ring = Math.floor(i / Math.ceil(allSorted.length / rings));
      const idxInRing = i - ring * Math.ceil(allSorted.length / rings);
      const countInRing = Math.min(Math.ceil(allSorted.length / rings), allSorted.length - ring * Math.ceil(allSorted.length / rings));
      
      const r = innerR + (outerR - innerR) * (ring / Math.max(1, rings - 0.3));
      const angPad = 0.02;
      const a = seg.start + angPad + (angSpan - 2 * angPad) * ((idxInRing + 0.5) / countInRing);
      
      nodePositions[s.idx] = {
        x: cx + r * Math.cos(a),
        y: cy + r * Math.sin(a),
        r: Math.max(12, Math.min(22, 10 + (connCount[s.idx] || 0) * 1.5))
      };
    });
  });
  
  // Hub position
  nodePositions[HUB_IDX] = { x: cx, y: cy, r: 38 };
  
  // Draw connection lines
  const gLines = document.createElementNS(NS, 'g');
  EDGES.forEach(([si, ti]) => {
    const sp = nodePositions[si], tp = nodePositions[ti];
    if (!sp || !tp) return;
    
    const isHighlit = highlightSystem === null || highlightSystem === si || highlightSystem === ti;
    
    const line = document.createElementNS(NS, 'line');
    line.setAttribute('x1', sp.x);
    line.setAttribute('y1', sp.y);
    line.setAttribute('x2', tp.x);
    line.setAttribute('y2', tp.y);
    line.setAttribute('stroke', CAT_COLORS[systems[si].category] || '#444');
    line.setAttribute('stroke-width', isHighlit ? 1.5 : 0.5);
    line.setAttribute('stroke-opacity', isHighlit ? (highlightSystem !== null ? 0.7 : 0.2) : 0.04);
    line.classList.add('connection-line');
    line.dataset.source = si;
    line.dataset.target = ti;
    gLines.appendChild(line);
  });
  svg.appendChild(gLines);
  
  // Draw nodes
  const gNodes = document.createElementNS(NS, 'g');
  
  // Hub node first
  if (nodePositions[HUB_IDX]) {
    const hp = nodePositions[HUB_IDX];
    const g = document.createElementNS(NS, 'g');
    g.classList.add('hub-glow');
    
    // Glow ring
    const ring = document.createElementNS(NS, 'circle');
    ring.setAttribute('cx', hp.x);
    ring.setAttribute('cy', hp.y);
    ring.setAttribute('r', hp.r + 6);
    ring.setAttribute('fill', 'none');
    ring.setAttribute('stroke', '#e8735a');
    ring.setAttribute('stroke-width', '2');
    ring.setAttribute('stroke-opacity', '0.3');
    g.appendChild(ring);
    
    const hex = document.createElementNS(NS, 'path');
    hex.setAttribute('d', hexPath(hp.x, hp.y, hp.r));
    hex.setAttribute('fill', '#e8735a');
    hex.setAttribute('fill-opacity', '0.9');
    hex.setAttribute('stroke', '#e8735a');
    hex.setAttribute('stroke-width', '2');
    hex.setAttribute('filter', 'url(#glow)');
    g.appendChild(hex);
    
    const t1 = document.createElementNS(NS, 'text');
    t1.setAttribute('x', hp.x);
    t1.setAttribute('y', hp.y - 4);
    t1.setAttribute('fill', '#fff');
    t1.setAttribute('font-size', '10');
    t1.setAttribute('font-weight', '700');
    t1.setAttribute('text-anchor', 'middle');
    t1.textContent = 'BAS';
    g.appendChild(t1);
    
    const t2 = document.createElementNS(NS, 'text');
    t2.setAttribute('x', hp.x);
    t2.setAttribute('y', hp.y + 10);
    t2.setAttribute('fill', '#fff');
    t2.setAttribute('font-size', '7');
    t2.setAttribute('font-weight', '500');
    t2.setAttribute('text-anchor', 'middle');
    t2.setAttribute('opacity', '0.7');
    t2.textContent = `${connCount[0] || 0} connections`;
    g.appendChild(t2);
    
    attachNodeEvents(g, systems[0], hp);
    gNodes.appendChild(g);
  }
  
  // Other nodes
  Object.entries(nodePositions).forEach(([idx, pos]) => {
    const i = parseInt(idx);
    if (i === HUB_IDX) return;
    const sys = systems[i];
    if (!sys) return;
    
    const isHighlit = highlightSystem === null || highlightSystem === i ||
      EDGES.some(([s, t]) => (s === highlightSystem && t === i) || (t === highlightSystem && s === i));
    
    const g = document.createElementNS(NS, 'g');
    g.classList.add('hex-node');
    g.style.opacity = isHighlit ? 1 : (highlightSystem !== null ? 0.15 : 1);
    
    const hex = document.createElementNS(NS, 'path');
    hex.setAttribute('d', hexPath(pos.x, pos.y, pos.r));
    hex.setAttribute('fill', (CAT_COLORS[sys.category] || '#666') + '33');
    hex.setAttribute('stroke', CAT_COLORS[sys.category] || '#666');
    hex.setAttribute('stroke-width', sys.mc ? 2 : 1);
    hex.setAttribute('stroke-opacity', sys.mc ? 0.9 : 0.5);
    g.appendChild(hex);
    
    if (sys.mc) {
      const star = document.createElementNS(NS, 'text');
      star.setAttribute('x', pos.x + pos.r - 4);
      star.setAttribute('y', pos.y - pos.r + 8);
      star.setAttribute('fill', '#e8735a');
      star.setAttribute('font-size', '8');
      star.setAttribute('font-weight', '700');
      star.textContent = '★';
      g.appendChild(star);
    }
    
    // Label
    const label = document.createElementNS(NS, 'text');
    label.setAttribute('x', pos.x);
    label.setAttribute('y', pos.y + 1);
    label.setAttribute('fill', '#ddd');
    label.setAttribute('font-size', pos.r > 16 ? '7' : '6');
    label.setAttribute('font-weight', '600');
    label.setAttribute('text-anchor', 'middle');
    label.setAttribute('dominant-baseline', 'middle');
    const short = sys.name.length > 18 ? sys.name.slice(0, 16) + '…' : sys.name;
    label.textContent = short;
    g.appendChild(label);
    
    attachNodeEvents(g, sys, pos);
    gNodes.appendChild(g);
  });
  
  svg.appendChild(gNodes);
  
  // Update stats
  document.getElementById('stats-line').textContent = 
    `${visible.length} systems · ${EDGES.filter(([s,t]) => nodePositions[s] && nodePositions[t]).length} connections · ${categories.length} categories`;
}

function attachNodeEvents(el, sys, pos) {
  el.style.cursor = 'pointer';
  
  el.addEventListener('mouseenter', (e) => {
    const cc = connCount[sys.idx] || 0;
    const connectedTo = EDGES
      .filter(([s, t]) => s === sys.idx || t === sys.idx)
      .map(([s, t]) => systems[s === sys.idx ? t : s]?.name)
      .filter(Boolean)
      .slice(0, 6);
    
    tooltip.innerHTML = `
      <div class="tt-name" style="color:${CAT_COLORS[sys.category] || '#ccc'}">${sys.name}</div>
      <div class="tt-cat">${sys.category}</div>
      <div class="tt-row"><span class="tt-label">Owner</span><span class="tt-val">${sys.owner || '—'}</span></div>
      <div class="tt-row"><span class="tt-label">Status</span><span class="tt-val">${sys.status || '—'}</span></div>
      <div class="tt-row"><span class="tt-label">Connections</span><span class="tt-val">${cc}</span></div>
      ${connectedTo.length ? '<div class="tt-row"><span class="tt-label">Connected to</span><span class="tt-val">' + connectedTo.join(', ') + (cc > 6 ? '…' : '') + '</span></div>' : ''}
      ${sys.mc ? '<div class="tt-mc">★ Mission Critical</div>' : ''}
    `;
    tooltip.classList.add('visible');
  });
  
  el.addEventListener('mousemove', (e) => {
    tooltip.style.left = (e.clientX + 14) + 'px';
    tooltip.style.top = (e.clientY - 10) + 'px';
  });
  
  el.addEventListener('mouseleave', () => {
    tooltip.classList.remove('visible');
  });
  
  el.addEventListener('click', () => {
    highlightSystem = highlightSystem === sys.idx ? null : sys.idx;
    render();
  });
}

// ─── CONTROLS ────────────────────────────────────────────────────
const catSelect = document.getElementById('filter-cat');
categories.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c;
  opt.textContent = c;
  catSelect.appendChild(opt);
});
catSelect.addEventListener('change', () => {
  filterCat = catSelect.value;
  highlightSystem = null;
  render();
});

const ownerSelect = document.getElementById('filter-owner');
const owners = [...new Set(systems.map(s => s.owner).filter(Boolean))].sort();
owners.forEach(o => {
  const opt = document.createElement('option');
  opt.value = o;
  opt.textContent = o;
  ownerSelect.appendChild(opt);
});
ownerSelect.addEventListener('change', () => {
  filterOwner = ownerSelect.value;
  highlightSystem = null;
  render();
});

document.getElementById('btn-mc').addEventListener('click', function() {
  mcOnly = !mcOnly;
  this.classList.toggle('active', mcOnly);
  highlightSystem = null;
  render();
});

document.getElementById('btn-reset').addEventListener('click', () => {
  filterCat = 'All';
  filterOwner = 'All';
  mcOnly = false;
  highlightSystem = null;
  catSelect.value = 'All';
  ownerSelect.value = 'All';
  document.getElementById('btn-mc').classList.remove('active');
  render();
});

// ─── LEGEND ──────────────────────────────────────────────────────
const legend = document.getElementById('legend');
legend.innerHTML = `<div class="legend-title">Categories</div>` +
  categories.map(c => {
    const cnt = systems.filter(s => s.category === c).length;
    return `<div class="legend-item" data-cat="${c}">
      <div class="swatch" style="background:${CAT_COLORS[c] || '#666'}"></div>
      <span>${c.length > 30 ? c.slice(0, 28) + '…' : c}</span>
      <span class="count">${cnt}</span>
    </div>`;
  }).join('') +
  `<div style="margin-top:8px;padding-top:6px;border-top:1px solid #2a2a44;font-size:9px;color:#555">
    <span style="color:#e8735a">★</span> = Mission Critical &nbsp; Click node to highlight
  </div>`;

legend.querySelectorAll('.legend-item').forEach(el => {
  el.addEventListener('click', () => {
    const cat = el.dataset.cat;
    filterCat = filterCat === cat ? 'All' : cat;
    catSelect.value = filterCat;
    highlightSystem = null;
    render();
  });
});

// ─── INIT ────────────────────────────────────────────────────────
render();
window.addEventListener('resize', render);
</script>
</body>
</html>
